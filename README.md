# Цифровой бригадир

Инструмент для планирования смен печатного цеха. Проект сочетает автоматическую подготовку данных, алгоритм назначения смен и PyQt5‑GUI для оперативного составления графика.

## Что включено
- **Десктопный планировщик** (`main.py`, `scheduler.py`, `ui_main_window.py`) — читает справочники и историю назначений, строит ротацию, укомплектовывает бригады и сохраняет выдачу.
- **Справочные и рабочие CSV** (`data/*.csv`, `assignment_history.csv`) — входные данные и журнал назначений для пайплайна/GUI.
- **Исследовательские ноутбуки** (`Gen_V2*.ipynb`) — площадка для экспериментов; стабильные решения переносим в код.

## Структура репозитория

| Путь | Назначение |
| --- | --- |
| `main.py`, `ui_main_window.py`, `ui_main_window.ui` | PyQt5‑GUI: выбор недели, запуск пайплайна, просмотр таблиц и сохранение результатов. |
| `scheduler.py` | Логика `DataPipeline`, `AssignmentEngine`, `SchedulerReport`. |
| `data/` | Актуальные CSV справочники и история (`workers.csv`, `equipment.csv`, `position_requirements.csv`, `plan.csv`, `assignment_history.csv`). Все хранятся в `utf-8-sig`. |
| `assignment_history.csv` | сохраняется из GUI при нажатии **Save**, служит журналом назначений. |
| `output/` | Читабельные `.txt` отчёты (`Расписание_Неделя_<N>.txt`) сохраняется из GUI. |
| `img/`, `index.html` | Материалы презентации и тестовая веб-витрина. |
| `Gen_V2.ipynb` | Исследовательский ноутбук; идеи переносим в код/README перед публикацией. |
| `requirements.txt` | Набор зависимостей (PyQt5, pandas, ipykernel и др.). |

## Подготовка окружения
1. **Python** — проект запускается на CPython 3.13.x. Перед обновлением версии согласуйте изменение и проверьте `python --version`.
2. **Виртуальное окружение** (из корня репозитория):
   ```bash
   python -m venv .venv
   source .venv/bin/activate          # Windows: .venv\Scripts\activate
   ```
3. **Зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

## Работа с данными
- Каталог `data/` содержит актуальные справочники и историю: персонал (`workers.csv`), оборудование (`equipment.csv`), требования к позициям (`position_requirements.csv`), оперативный план (`plan.csv`) и исторические назначения 
- Журнал (`assignment_history.csv`). Эти файлы одновременно служат эталоном и входами для GUI. Ведётся самим приложением: при нажатии **Save** данные текущей недели добавляются или заменяются.
- Обновляйте CSV только при осознанной необходимости. Если данные готовятся внешними скриптами/Excel, сохраняйте результат в `utf-8-sig`.
- `data/plan.csv` разрешено редактировать вручную (меняются статусы машин по сменам).


## Запуск десктопного планировщика
1. Убедитесь, что `.venv` активирован, а `data/*.csv` актуальны.
2. Стартуйте GUI:
   ```bash
   python main.py
   ```
3. В окне по умолчанию подставляется следующий понедельник; при необходимости выберите другой.
4. Нажмите **Generate** — пайплайн выполнит:
   - построение ротации по прошлой неделе (`DataPipeline`);
   - подбор сотрудников на смены с учётом рангов и занятости (`AssignmentEngine`);
   - формирование таблиц и текстового отчёта (`SchedulerReport`).
5. Кнопка **Save** сохранит CSV (`assignment_output_GUI.csv`, кодировка `utf-8-sig`) и читабельный TXT (`output/Расписание_Неделя_<N>.txt`). Если неделя уже есть в CSV, появится диалог с подтверждением перезаписи.
6. Вкладки **Workers / Equipment / History / Plan** выводят исходные DataFrame напрямую, что помогает при проверках.

## Как устроен пайплайн
- **DataPipeline** берёт `data/assignment_history.csv` (используются столбцы `worker_id`, `week`, `shift`) и применяет правило ротации «ночь → вечер → день → ночь». Дополнительно формирует «длинный» производственный план по каждой машине и смене.
- **AssignmentEngine** обходит слоты в несколько туров (`ferst/second/third`) для каждой смены, следит за глобально назначенными сотрудниками, расформировывает бригады с половинной укомплектованностью и пытается доукомплектовать их финальным проходом.
- **SchedulerReport** объединяет смены, добавляет ФИО работников, считает укомплектованность, помечает проблемные бригады и готовит краткий текстовый дайджест для GUI и TXT-файла.
